---
title: "[언리얼5/UE5] 언리얼 엔진 디버깅, 프로파일링 툴"
date: 2024-11-22
toc: true
categories:
  - "Tistory"
tags:
  - "tistory"
---

프로젝트에서 최적화 해야 될 에셋이 있어서 찾아보게되었습니다.



언리얼엔진은 멀티쓰레드로 작동이 된다.

GameThread: 각 프레임마다 업데이트되어야할 로직을 처리하고, primitive한 데이터를 renderThread에 전달

RenderThread: visiblity를 체크하고 RenderCommand를 만들어준다. ( 부하를 줄이기 위해서 RHI Thread를추가했다.)

![](https://blog.kakaocdn.net/dna/bNwH5c/btsKSw0omoQ/AAAAAAAAAAAAAAAAAAAAAJe2T9goiOOWstk6uNtaAjTE4F_beuI9VckkMThSPuEP/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=pFA7Wn7Wq5ywNV93l%2BBpXV%2B71KQ%3D)

목표한 프레임에 따라 작업 속도이다.

![](https://blog.kakaocdn.net/dna/crBCwy/btsKQ9Flw7Q/AAAAAAAAAAAAAAAAAAAAAKH1DglSNERmN3MmHppAUqxwSD3DD2wFzoA7P3jp-D_m/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=4UeAAGNoLr4aVwwcbdIBOYafq%2F4%3D)

|  |  |
| --- | --- |
| **CPU쪽 부하** | **GPU쪽 부하** |
| Game: GameThread Draw: RenderThread  RHIT: RHI Thread | GPU Time |

![](https://blog.kakaocdn.net/dna/bl8ZkY/btsKS5Vw7Fa/AAAAAAAAAAAAAAAAAAAAANUomcRYBQAnQHRX2pQs0AhQ1Cq1P6pK4lTMFBwarWhU/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=BoMPLGzUiqAy4WPsmqZMV5dctqM%3D)

### 

### **UnrealInsight 실행시키기**

1. UnrealInsight.exe 실행하기

![](https://blog.kakaocdn.net/dna/cMwc6S/btsKRv2rPA4/AAAAAAAAAAAAAAAAAAAAAPiNg0CRnpGEM8SHiMXsWFkxXFo3SRpVaT33ypgWGKHG/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=iKbw7jWwmHcP4m57CIVrI2iSvUc%3D)

2. 게임 실행시키기

![](https://blog.kakaocdn.net/dna/rZ9ZW/btsKQLklOHc/AAAAAAAAAAAAAAAAAAAAABzvvJ_1sEOAbEKOHU_pGhOIIAqsD9dR0rJ8Krcv95Mm/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=XF8msDo2e7KubwE7%2FpQrDs5GrGM%3D)

3. Connect 버튼 눌러서 연결하기

![](https://blog.kakaocdn.net/dna/lSM8w/btsKS9DA78Q/AAAAAAAAAAAAAAAAAAAAALD6hx3e-Dgdtu27UGj61e2m5CPYHpNuCBdCjZZZAdGm/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=3hHIt5FP71uFjp646U6KiAZ3g2Q%3D)
![](https://blog.kakaocdn.net/dna/bwnNWT/btsKRRYrJ3l/AAAAAAAAAAAAAAAAAAAAANFHnvW7yUxIEBEIEs6HKksLDxe5SP4kiGja3ZiAlav6/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=dUA4Dx%2BgWlQ%2BaIJVFhwySwWXYmc%3D)
![](https://blog.kakaocdn.net/dna/PWi2F/btsKR5WwGiX/AAAAAAAAAAAAAAAAAAAAABaLXmlHoAdhJq58hgBJJbap5qkG8FzBGw10YCYMVnkr/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=l4xqALWSKTTbiwZ5PlWxCSAKYYk%3D)

하단에서 로그를 확인할 수 있고, 로그에 필터를 걸어서 필요한 정보만 볼 수 있고,

우클릭으로 visualStudio에서 로그가 실행된 지점을 찾아서 확인하는 것도 가능하다.

![](https://blog.kakaocdn.net/dna/lFSTO/btsKQHh2LKg/AAAAAAAAAAAAAAAAAAAAAOfC4q8yeefi6_Jhd4vVobMCQN68wTX_ik20Rh7VnXEW/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=nbMO93PT1rrVD2lS%2FKw8F9yEpt0%3D)
![](https://blog.kakaocdn.net/dna/81PY2/btsKSoan9ic/AAAAAAAAAAAAAAAAAAAAABnQVMr0u9ZGuySAXLRchwUE_H5bvE_yIPrbeW8X0Qwz/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=qlCEA4EEFtUsK%2BxySdyuPG1KALA%3D)
![](https://blog.kakaocdn.net/dna/3en52/btsKSQqKxRo/AAAAAAAAAAAAAAAAAAAAAFIDQlu2hSQIOZUrHev066seCVrznpszN5Ew1BKqlxmc/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=pKzjkFt5juPeUA10JjrQVukHWtQ%3D)
![](https://blog.kakaocdn.net/dna/bjzrwt/btsKRv2skyw/AAAAAAAAAAAAAAAAAAAAAEhmK0vBZ3FJAQf_ciHdB8YAmoG2I6_Morm5lIUID25K/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=pI7j2Ui%2BYHY1DlTsEQLgHily674%3D)
![](https://blog.kakaocdn.net/dna/d0BoYN/btsKQCA30sl/AAAAAAAAAAAAAAAAAAAAAHPytOsBPUeIk41ceX2cXLTlrwsUHHjMMblEpnTxbNuO/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=v9irTHfv%2BLpxYYs13FGqhvCItCM%3D)
![](https://blog.kakaocdn.net/dna/cQCDoA/btsKSi9amYQ/AAAAAAAAAAAAAAAAAAAAACpBoqVbALehDT2JRuP3rrj6ymWxYUKLmMwbHsU0bM8c/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=haLV8A0CRHQbtFkq4xfBv58EkSg%3D)
![](https://blog.kakaocdn.net/dna/V7WvU/btsKSu2BXxC/AAAAAAAAAAAAAAAAAAAAAPmUUcVIF4kux0Y9mqUV4pqXD8rf3yWJKAxNKN14UmnP/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=UIcmd%2FDpkGglMkhMOrMf0D1fHWw%3D)

단축키 M : 중요이벤트에 대한 마커로 레벨로딩, 엔진 부팅 단계를 보여준다. BP에서 print한 내용도 볼 수 있다.

bookmask:

![](https://blog.kakaocdn.net/dna/bVw4OW/btsKQNP5yi2/AAAAAAAAAAAAAAAAAAAAAIeNY0ATCnmFOmL_viqrqKnAHjQiFrAjJL9f4uIKejoE/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=uDAYSJsJm7If0olJUxoSvs2oMgM%3D)
![](https://blog.kakaocdn.net/dna/nngWX/btsKRbcakJA/AAAAAAAAAAAAAAAAAAAAADERq4BG8FheFO7qBLFsfze7i_wxMgjEhiJ_d59ppOw3/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=Yu%2F1ApbhVAug3CWSSekCft9npUs%3D)
![](https://blog.kakaocdn.net/dna/cev8pg/btsKSJZve7t/AAAAAAAAAAAAAAAAAAAAAFNrBnrfB-lq0RtvKBwVM2rsalX_AJdNMxYqbLTBDAYd/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=mQIC8JRz3wo29b8l19UGK9GQjj0%3D)

GC: Mark and Sweep (언리얼), Reference Count  방법이 있다.

Mark and Swip이 원래 한 프레임 안에서 일어났지만, 5.4이후 부터 여러 프레임으로 나눠서 하는 방법을 사용할 수 있다.

GC에 의한 히치를 줄일 좋은 방법이다.

![](https://blog.kakaocdn.net/dna/T9dfz/btsKQEFv9XX/AAAAAAAAAAAAAAAAAAAAAB43AeZTwbGnrhAvXer6chNKhYvSK5Ieh5O9-lLIBVMf/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=rSO2OqBGFxCIhraz3wk5bEx7Fw0%3D)

### 

### **최적화 기법**

**LTO(Link Time Optimization)**

헤더 파일과 cpp가 분리되어 있는 인라인 함수에 대해서도 링크 타임에 최적화를 해준다. (남발 X,  재귀 호출 X)

**PGO( Optimization)**

이를 보완하면서 같이 사용되는것이 PGO

LTO를 통해서 inline함수를 계속 적용하면, 코드의 크기가 너무 커진다.

프로파일 단에서 컴파일러 데이터를 보고 실제로 많이 호출되는 부분을 추적해서 inline화 한다.

아래 그림처럼 i =10이 자주 발생하면, 애초에 swtich문에 들어가지 않을 수 있도록 컴파일러가 최적화를 해준다.

![](https://blog.kakaocdn.net/dna/zkrej/btsKQzRQTLb/AAAAAAAAAAAAAAAAAAAAANS5M7UKZR64vuhUtallkYweK2RslL4w-1Gi-xSxKKkl/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=xylTee8cZLllgTc0tr8PqYUSl9s%3D)

**언리얼에 적용하는 법(링크할 때 오래거린다.)**

PGOProfile과 PGOOptimize 동시 불가

![](https://blog.kakaocdn.net/dna/nOgQr/btsKSiBkSdj/AAAAAAAAAAAAAAAAAAAAABfSlKuMhWqSTUJ35y1KbPONRMmVutpuReV7qX5cVSu_/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=axKX8gRNh9Q%2FnK2j5zlXN%2FzSfxQ%3D)

### **메모리 프로파일링**

Insight에서 trace 옵션에 memory를 추가해도, memory insights가 추가가 안되서,

document를 찾아봤다.

이대로 해도 안된다..

![](https://blog.kakaocdn.net/dna/dF4Vv0/btsKRELGp1S/AAAAAAAAAAAAAAAAAAAAAC1wy5N6RhQ55ojHGTn_ocMoQWV4SV5y9fCNqOA6_aB-/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=sX%2B4fKYsyQywOB4xc9icfHZtMGw%3D)

찾고 찾다가 방법을 알아냈다.

프로젝트.exe 말고, 엔진.exe를 실행시키면 잘 작동되는 것을 확인할 수 있다.

![](https://blog.kakaocdn.net/dna/lcNAD/btsKRdOzs6b/AAAAAAAAAAAAAAAAAAAAANrC4fA4ZfBvRxfdlsSS_YnhTvpQj-XGVt2opNdJzl6U/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=bopZ%2BSxWurqOKR6nzvYY%2Fk2kn1I%3D)

Rule도 부여하면서, 메모리 릭을 추적해볼 수 있다.

![](https://blog.kakaocdn.net/dna/NBXQU/btsKSoBATdq/AAAAAAAAAAAAAAAAAAAAANt0a0eG_Q-szB544u1kTkLBRF1BAGrmtZjs6L6T78MT/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=GoYrhruvy4yuXBiwqiYL803N%2Bzg%3D)

### 

### **GPU부하일 경우**

**control + shiftg + , 로 GPU visualizor를 볼 수 있다.**

![](https://blog.kakaocdn.net/dna/6YNhf/btsKR3j6BFT/AAAAAAAAAAAAAAAAAAAAAIK3ensRLOAIoxOsl1KOVqd0o49ig6CV8zhOyUVILdP-/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=WUlr32zBLT797k38smJYgCuHubE%3D)
![](https://blog.kakaocdn.net/dna/l3I3A/btsKSgcwFcW/AAAAAAAAAAAAAAAAAAAAAHC4MkpjdmVcEyOzBtlLXoCSxCmKGTlKRB6dCUR1J7vJ/img.png?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1772290799&allow_ip=&allow_referer=&signature=kh4XkAfanE2r%2FhtPQ5I5%2FY3NmTQ%3D)