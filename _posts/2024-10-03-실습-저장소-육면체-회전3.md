---
title: "[실습 저장소] 육면체 회전(3)"
date: 2024-10-03
toc: true
categories:
  - "Tistory"
tags:
  - "tistory"
---

## **Problem**

회전은 하는데 이상하게 보인다



지금까지 Simplified Pipleline을 사용하고있다.

원래는 앞에 있는 오브젝트가 뒤에 있는 오브젝트를 가려야되는데

(눈에서 가까운 오브젝트가 먼 오브젝트를 가려야하는데)

여기서는 CPU에서 GPU로 늦게 보낸 삼각형이 위로 덮어씌워진다.(깊이는 관련 없이 전송되어진 순서로만 따지고 있다.)

## **Solution**

전송 순서로 렌더링 되는 것을 깊이 순서로 렌더링 되게 바꿔보자

근데

-> 삼각형을 메모리에 올리기 싫어서 simplifed pipline을 사용하는건데,,, 메모리에 올려서 sorting까지..?

-> 그리고 물체를 돌리다보면 매 frame마다 sorting을....?

**Z-Buffer**

위의 문제들에 대한 대안으로 Z-Buffer가 등장한다.

보인다 == 가장 가까이 있는 물체 라는 것 (투명일 경우에는 또 달라지지만... 여기서는 배체하자)

Buffer는 Memory라고 생각하면 된다.

그림을 그릴 때는 Color Buffer를 사용한다.

1000 by 1000 화면으로 예를 들면  
화면에는 1000\* 1000 = 100만개의 Color Buffrer가 있다.

그때 Z-Buffer도 100만개가 존재하고,  Z값을 기억한다.

초기 값은 -무한대로 한다.(내 앞에 아무것도 없다.)

색을 줄 때 지금까지 하던 process에서 1가지만 더 추가한다.

내가 그릴 물체의 z-buffer의 값과 현재의 z-buffer를 비교한다.

내 시선과 **더 가깝**다고 판단되면 **색을 칠하면서, z-buffer를 업데이트한다.**

내 시선과 **더 멀다**고 판단되면 **색을 칠하지 않고, z-buffer도 업데이트 하지 않는다.**

**Z-Buffer를 추가해주면 이렇게 잘 실행이 된다.**



**+색이 보간(Interpolation)되는 점에 대해**

우리가 보낸 것은 꼭지점의 색뿐이다.(단 8개)

근데 왜 그라데이션이 나타나는가

VertexShader 가 3개의 점을 FragmentShader로 out 시킨다.

FragmentShader는 매우 많은 점을 받는다.

-> 그 과정(Vertex To Fragment)에서 Raterization Stage가 있다.

여기서 3개의 점이 포함하는(?) 평면을 계산한다. (삼각형의 내부의 점들을 계산 한다. )

그리고 평면에 있는 점들의 색을 보간(interpolation)해서 할당해준다.